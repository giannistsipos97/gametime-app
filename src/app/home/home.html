<div class="flex flex-col items-center w-full mt-14">
  <!-- Search bar centered -->
  <!-- <div class="w-full max-w-xl">
    <app-search class="w-full h-14"></app-search>
  </div> -->

  <div class="self-center">
    <p-chip
      label="Currently Playing"
      class="text-m p-2 !text-black font-bold !rounded-full !bg-[#09992d] !px-2 !py-1 !gap-1"
    ></p-chip>
  </div>

  @if(currentlyPlaying$ | async; as currentlyPlaying){
  <div class="card-container flex gap-4 mt-8 overflow-x-auto">
    @for (game of currentlyPlaying; track game.id) {
    <p-card class="rounded-3xl flex-none overflow-hidden border border-solid border-black">
      <ng-template #header>
        <img
          [routerLink]="['/gameDetails', game.id]"
          alt="Card"
          class="w-full h-48 object-cover cursor-pointer"
          [src]="game.background_image"
        />
      </ng-template>
      <ng-template #title>
        <div class="flex justify-between items-center">
          <span class="line-clamp-1">{{ game.name }}</span>
          <!-- <i class="fa-solid fa-ellipsis-vertical cursor-pointer"></i> -->
        </div>

        <div class="flex gap-2 pt-2 pl-1">
          @for (platform of game.parent_platforms; track platform.platform.id){
          <i
            class="{{platform.platform.name | platformIcon}}"
            [pTooltip]="platform.platform.name"
            tooltipPosition="bottom"
          ></i>
          }
        </div>
      </ng-template>
      <ng-template #subtitle>
        <div class="flex justify-end gap-1">
          <button
            pButton
            class="text-black w-8 h-8 text-sm rounded-full bg-white border border-solid border-black hover:bg-green-500"
            (click)="finish(game)"
          >
            <i class="fas fa-check"></i>
          </button>
          <button
            pButton
            class="text-black w-8 h-8 text-sm rounded-full bg-white border border-solid border-black hover:bg-red-500"
            pTooltip="Remove from Play Next"
            tooltipPosition="bottom"
            (click)="removeFromPlaying(game)"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </ng-template>
    </p-card>
    }
  </div>
  }

  <div class="flex flex-col justify-center mt-10 px-6">
    <p-chip
      label="Currently Playing"
      class="text-m p-2 !text-black font-bold !rounded-full !bg-[#D48806] !px-2 !py-1 !gap-1"
    ></p-chip>
  </div>

  <div class="card-container flex gap-4 mt-8 overflow-x-auto">
    @for (playnextGame of playnextGames; track $index) {
    <p-card class="rounded-3xl flex-none overflow-hidden border border-solid border-black">
      <ng-template #header>
        <img
          [routerLink]="['/gameDetails', playnextGame.id]"
          alt="Card"
          class="w-full h-48 object-cover cursor-pointer"
          [src]="playnextGame.background_image"
        />
      </ng-template>
      <ng-template #title>
        <div class="flex justify-between items-center">
          <span class="line-clamp-1">{{ playnextGame.name }}</span>
          <!-- <i class="fa-solid fa-ellipsis-vertical cursor-pointer"></i> -->
        </div>

        <div class="flex gap-2 pt-2 pl-1">
          @for (platform of playnextGame.parent_platforms; track platform.platform.id){
          <i
            class="{{platform.platform.name | platformIcon}}"
            [pTooltip]="platform.platform.name"
            tooltipPosition="bottom"
          ></i>
          }
        </div>
      </ng-template>
      <ng-template #subtitle>
        <div class="flex justify-end gap-1">
          <button
            pButton
            class="text-black w-8 h-8 text-sm rounded-full bg-white border border-solid border-black hover:bg-[#D48806]"
            pTooltip="Add to currently playing"
            tooltipPosition="bottom"
            (click)="addToPlaying(playnextGame)"
          >
            <i class="fa-solid fa-play"></i>
          </button>
          <button
            pButton
            class="text-black w-8 h-8 text-sm rounded-full bg-white border border-solid border-black hover:bg-red-500"
            pTooltip="Remove from Play Next"
            tooltipPosition="bottom"
            (click)="removeFromPlayNext(playnextGame)"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </ng-template>
    </p-card>
    }
  </div>
</div>

@if(displayCompletedDialog){
<app-complete-dialog
  [title]="'Game Completion Details'"
  [selectedGame]="selectedGame"
  (closeDialog)="displayCompletedDialog = $event"
  (updateCurrentlyPlaying)="removeFromPlaying($event)"
></app-complete-dialog>
}

<p-toast />
